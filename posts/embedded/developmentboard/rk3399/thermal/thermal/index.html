<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Embedded:RK3399 Thermal (温度控制) - 这是我的网站</title><meta name="Description" content="RK3399 Thermal (温度控制)"><meta property="og:title" content="Embedded:RK3399 Thermal (温度控制)" />
<meta property="og:description" content="RK3399 Thermal (温度控制)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" /><meta property="og:image" content="https://zhangyuhu.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-09T14:32:52+08:00" />
<meta property="article:modified_time" content="2023-02-09T15:11:52+08:00" /><meta property="og:site_name" content="我的网站" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://zhangyuhu.github.io/logo.png"/>

<meta name="twitter:title" content="Embedded:RK3399 Thermal (温度控制)"/>
<meta name="twitter:description" content="RK3399 Thermal (温度控制)"/>
<meta name="application-name" content="我的网站">
<meta name="apple-mobile-web-app-title" content="我的网站"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" /><link rel="prev" href="https://zhangyuhu.github.io/posts/embedded/developmentboard/rv1126rv1109/rv1126_camera%E8%B0%83%E8%AF%95%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" /><link rel="next" href="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/rknn/" /><link rel="stylesheet" href="/css/style.min.990eb8dd228a2b662f63cfe59575be8aa494cb9d40ffd854f26b9d9e588e1f4fdadb6a34e3f9a9171244d3ee6c107521923ab30705f3ef50d3e435eda1afc910.css" integrity="sha512-mQ643SKKK2YvY8/llXW+iqSUy51A/9hU8mudnliOH0/a22o04/mpFxJE0+5sEHUhkjqzBwXz71DT5DXtoa/JEA=="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Embedded:RK3399 Thermal (温度控制)",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/zhangyuhu.github.io\/posts\/embedded\/developmentboard\/rk3399\/thermal\/thermal\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/zhangyuhu.github.io\/images\/Apple-Devices-Preview.png",
                            "width":  3200 ,
                            "height":  2048 
                        }],"genre": "posts","keywords": "Embedded, 芯片\u0026开发板, RK3399","wordcount":  4709 ,
        "url": "https:\/\/zhangyuhu.github.io\/posts\/embedded\/developmentboard\/rk3399\/thermal\/thermal\/","datePublished": "2023-02-09T14:32:52+08:00","dateModified": "2023-02-09T15:11:52+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "zhangyuhu"
            },"description": "RK3399 Thermal (温度控制)"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="这是我的网站"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/" title="文章"><i class='fas fa-archive fa-fw fa-sm'></i> 文章 </a><a class="menu-item" href="/tags/"><i class='fas fa-tags fa-fw fa-sm'></i> 标签 </a><a class="menu-item" href="/categories/"><i class='fas fa-th fa-fw fa-sm'></i> 分类 </a><a class="menu-item" href="/about/"><i class='fas fa-user-tie fa-fw fa-sm'></i> 关于 </a><a class="menu-item" href="/tool/"><i class='fas fa-cube fa-fw fa-sm'></i> 工具箱 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="这是我的网站"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="文章"><i class='fas fa-archive fa-fw fa-sm'></i>文章</a><a class="menu-item" href="/tags/" title=""><i class='fas fa-tags fa-fw fa-sm'></i>标签</a><a class="menu-item" href="/categories/" title=""><i class='fas fa-th fa-fw fa-sm'></i>分类</a><a class="menu-item" href="/about/" title=""><i class='fas fa-user-tie fa-fw fa-sm'></i>关于</a><a class="menu-item" href="/tool/" title=""><i class='fas fa-cube fa-fw fa-sm'></i>工具箱</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Embedded:RK3399 Thermal (温度控制)</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://zhangyuhu.github.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>zhangyuhu</a></span>&nbsp;<span class="post-category">included in <a href="/categories/embedded/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Embedded</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-02-09">2023-02-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4709 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;10 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#thermal-是什么">Thermal 是什么</a></li>
    <li><a href="#配置法">配置⽅法</a>
      <ul>
        <li><a href="#menuconfig配置">Menuconfig配置</a></li>
        <li><a href="#tsadc配置">Tsadc配置</a></li>
        <li><a href="#cpu--gpu配置">CPU &amp; GPU配置</a></li>
        <li><a href="#termal-zone-配置">Termal zone 配置</a></li>
      </ul>
    </li>
    <li><a href="#态接口">⽤⼾态接口</a></li>
    <li><a href="#常用设置">常用设置</a>
      <ul>
        <li><a href="#获取当前温度">获取当前温度</a></li>
        <li><a href="#关闭温度控制功能">关闭温度控制功能</a></li>
      </ul>
    </li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>本文采用<a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreffer ">知识共享署名 4.0 国际许可协议</a>进行许可，转载时请注明原文链接，图片在使用时请保留全部内容，可适当缩放并在引用处附上图片所在的文章链接。</p>
</blockquote>
<!-- TOC -->
<ul>
<li><a href="#thermal-%e6%98%af%e4%bb%80%e4%b9%88" rel="">Thermal 是什么</a></li>
<li><a href="#%e9%85%8d%e7%bd%ae%e6%b3%95" rel="">配置⽅法</a>
<ul>
<li><a href="#menuconfig%e9%85%8d%e7%bd%ae" rel="">Menuconfig配置</a></li>
<li><a href="#tsadc%e9%85%8d%e7%bd%ae" rel="">Tsadc配置</a></li>
<li><a href="#cpu--gpu%e9%85%8d%e7%bd%ae" rel="">CPU &amp; GPU配置</a></li>
<li><a href="#termal-zone-%e9%85%8d%e7%bd%ae" rel="">Termal zone 配置</a></li>
</ul>
</li>
<li><a href="#%e6%80%81%e6%8e%a5%e5%8f%a3" rel="">⽤⼾态接口</a></li>
<li><a href="#%e5%b8%b8%e7%94%a8%e8%ae%be%e7%bd%ae" rel="">常用设置</a>
<ul>
<li><a href="#%e8%8e%b7%e5%8f%96%e5%bd%93%e5%89%8d%e6%b8%a9%e5%ba%a6" rel="">获取当前温度</a></li>
<li><a href="#%e5%85%b3%e9%97%ad%e6%b8%a9%e5%ba%a6%e6%8e%a7%e5%88%b6%e5%8a%9f%e8%83%bd" rel="">关闭温度控制功能</a></li>
</ul>
</li>
<li><a href="#%e5%8f%82%e8%80%83" rel="">参考</a></li>
</ul>
<!-- /TOC -->
<h1 id="thermal-是什么">Thermal 是什么</h1>
<p>Thermal是内核开发者定义的⼀套⽀持根据指定governor控制系统温度，以防⽌芯⽚过热的框架模型。Thermal framework由governor、core、cooling device、sensor driver组成，软件架构如下：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.jsdelivr.net/gh/zhangyuhu/share_images/images/202302092105971.png"
        data-srcset="https://cdn.jsdelivr.net/gh/zhangyuhu/share_images/images/202302092105971.png, https://cdn.jsdelivr.net/gh/zhangyuhu/share_images/images/202302092105971.png 1.5x, https://cdn.jsdelivr.net/gh/zhangyuhu/share_images/images/202302092105971.png 2x"
        data-sizes="auto"
        alt="https://cdn.jsdelivr.net/gh/zhangyuhu/share_images/images/202302092105971.png"
        title="image-20210715200645622" /></p>
<ul>
<li>Thermal governor：⽤于决定cooling device是否需要降频，降到什么程度。⽬前Linux4.4内核中包含了如下⼏种governor：</li>
<li>power_allocator：引⼊PID（⽐例-积分-微分）控制，根据当前温度，动态给各cooling device分配power，并将power转换为频率，从而达到根据温度限制频率的效果。</li>
<li>step_wise ：根据当前温度，cooling device逐级降频。</li>
<li>fair share ：频率档位⽐较多的cooling device优先降频。</li>
<li>userspace：不限制频率。</li>
<li>Thermal core： 对thermal governors和thermal driver进⾏了封装和抽象，并定义了清晰的接口。</li>
<li>Thermal sensor driver：sensor驱动，⽤于获取温度，⽐如tsadc。</li>
<li>Thermal cooling device：发热源或者可以降温的设备，⽐如CPU、GPU、DDR等。</li>
</ul>
<h1 id="配置法">配置⽅法</h1>
<h2 id="menuconfig配置">Menuconfig配置</h2>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-18">18</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;*&gt; Generic Thermal sysfs driver   ---&gt;
</span></span><span style="display:flex;"><span> --- Generic Thermal sysfs driver
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span>*<span style="color:#555">]</span>   APIs to parse thermal data out of device tree
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span>*<span style="color:#555">]</span>   Enable writable trip points
</span></span><span style="display:flex;"><span> Default Thermal governor <span style="color:#555">(</span> power_allocator <span style="color:#555">)</span>   ---&gt;   /* default thermal governor */
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span> <span style="color:#555">]</span>   Fair -share thermal governor
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span> <span style="color:#555">]</span>   Step_wise thermal governor                       /* step_wise governor */
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span> <span style="color:#555">]</span>   Bang Bang thermal governor
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span>*<span style="color:#555">]</span>   User_space thermal governor                     /* user_space governor */
</span></span><span style="display:flex;"><span> -*-   Power allocator thermal governor                 /* power_allocator governor */
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span>*<span style="color:#555">]</span>   generic cpu cooling support                     /* cooling device */
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span> <span style="color:#555">]</span>   Generic clock cooling support
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span>*<span style="color:#555">]</span>   Generic device cooling support                   /* cooling device */
</span></span><span style="display:flex;"><span> <span style="color:#555">[</span> <span style="color:#555">]</span>   Thermal emulation mode support
</span></span><span style="display:flex;"><span> &lt; &gt;   Temperature sensor driver <span style="color:#069;font-weight:bold">for</span> Freescale i.MX SoCs
</span></span><span style="display:flex;"><span> &lt;*&gt;   Rockchip thermal driver                         /* thermal sensor driver */
</span></span><span style="display:flex;"><span> &lt; &gt;     rk_virtual thermal driver
</span></span><span style="display:flex;"><span> &lt;*&gt;     rk3368 thermal driver legacy                   /* thermal sensor driver */
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过“Default Thermal governor”配置项，可以选择温控策略，开发者可以根据实际产品需求进⾏修改。</p>
<h2 id="tsadc配置">Tsadc配置</h2>
<p>Tsadc在温控中作为thermal sensor，⽤于获取温度，通常需要在DTSI和DTS都做配置。
以RK3399为例，DTSI包括如下配置：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-22">22</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-23">23</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-24">24</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-25">25</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-26">26</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-27">27</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-28">28</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-29">29</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-30">30</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-31"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-31">31</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-32"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-32">32</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-33"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-33">33</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-34"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-34">34</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-35"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-35">35</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-36"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-36">36</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-37"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-37">37</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-38"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-38">38</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-39"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-39">39</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">tsadc</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">tsadc@ff</span><span style="color:#f60">260000</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">compatible</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;rockchip,rk3399-tsadc&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">reg</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">xff</span><span style="color:#f60">260000</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">100</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">寄存器基地址和寄存器地址总⻓度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">interrupts</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;GIC_SPI</span> <span style="color:#f60">97</span> <span style="color:#a00;background-color:#faa">IRQ_TYPE_LEVEL_HIGH</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">中断号及中断触发⽅式</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">assigned</span> <span style="color:#a00;background-color:#faa">-clocks</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">SCLK_TSADC</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⼯作时钟，</span><span style="color:#f60">750</span><span style="color:#a00;background-color:#faa">KHz</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">assigned</span> <span style="color:#a00;background-color:#faa">-clock</span> <span style="color:#a00;background-color:#faa">-rates</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">750000</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clocks</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">SCLK_TSADC</span> <span style="color:#a00;background-color:#faa">&gt;</span>, <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">PCLK_TSADC</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⼯作时钟和配置时钟</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clock</span> <span style="color:#a00;background-color:#faa">-names</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;tsadc&#34;</span> , <span style="color:#309;font-weight:bold">&#34;apb_pclk&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">resets</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">SRST_TSADC</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">复位信号</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">reset</span> <span style="color:#a00;background-color:#faa">-names</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;tsadc-apb&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">rockchip</span> ,<span style="color:#a00;background-color:#faa">grf</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">grf</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">引⽤grf</span> <span style="color:#a00;background-color:#faa">模块，部分平台需要</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">rockchip</span> <span style="color:#a00;background-color:#faa">,hw</span> <span style="color:#a00;background-color:#faa">-tshut</span> <span style="color:#a00;background-color:#faa">-temp</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;120000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">过温重启阀值，120</span> <span style="color:#a00;background-color:#faa">摄⽒度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">tsadc</span> <span style="color:#a00;background-color:#faa">输出引脚配置，⽀持两种模式：gpio</span> <span style="color:#a00;background-color:#faa">和otpout</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">pinctrl</span> <span style="color:#a00;background-color:#faa">-names</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;gpio&#34;</span> , <span style="color:#309;font-weight:bold">&#34;otpout&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">pinctrl</span> <span style="color:#f60">-0</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">otp_gpio</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">pinctrl</span> <span style="color:#f60">-1</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">otp_out</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">/*</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">thermal</span> <span style="color:#a00;background-color:#faa">sensor</span> <span style="color:#a00;background-color:#faa">标识，表⽰tsadc</span> <span style="color:#a00;background-color:#faa">可以作为⼀个thermal</span> <span style="color:#a00;background-color:#faa">sensor</span> <span style="color:#a00;background-color:#faa">，</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">并指定了引⽤tsadc</span> <span style="color:#a00;background-color:#faa">节点的时候需要带⼏个参数。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">如果SoC</span> <span style="color:#a00;background-color:#faa">⾥⾯只有⼀个tsadc</span> <span style="color:#a00;background-color:#faa">，可以设置为</span><span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">，超过⼀个必须设置为</span><span style="color:#f60">1</span><span style="color:#a00;background-color:#faa">。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">#thermal-sensor-cells</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">1</span><span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">status</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;disabled&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">IO</span> <span style="color:#a00;background-color:#faa">口配置</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">pinctrl</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">pinctrl</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">tsadc</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">配置为gpio</span> <span style="color:#a00;background-color:#faa">模式</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">otp_gpio</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">otp</span> <span style="color:#a00;background-color:#faa">-gpio</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">rockchip</span> <span style="color:#a00;background-color:#faa">,pins</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1</span> <span style="color:#a00;background-color:#faa">6</span> <span style="color:#a00;background-color:#faa">RK_FUNC_GPIO</span> <span style="color:#a00;background-color:#faa">&amp;pcfg_pull_none</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>        }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">配置为over</span> <span style="color:#a00;background-color:#faa">temperature</span> <span style="color:#a00;background-color:#faa">protection</span> <span style="color:#a00;background-color:#faa">模式</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">otp_out</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">otp</span> <span style="color:#a00;background-color:#faa">-out</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">rockchip</span> <span style="color:#a00;background-color:#faa">,pins</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1</span> <span style="color:#a00;background-color:#faa">6</span> <span style="color:#a00;background-color:#faa">RK_FUNC_1</span> <span style="color:#a00;background-color:#faa">&amp;pcfg_pull_none</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>        }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">....</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>DTS的配置，主要⽤于选择通过CRU复位还是GPIO复位，低电平复位还是⾼电平复位。需要特别注意的是如果配置成GPIO复位，硬件上需要否把tsadc输出引脚连到PMIC的复位脚，否则只能配置成CRU复位。</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-1">1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-2">2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-3">3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-4">4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-2-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-2-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">&amp;tsadc</span> {
</span></span><span style="display:flex;"><span>     <span style="color:#a00;background-color:#faa">rockchip</span> <span style="color:#a00;background-color:#faa">,hw</span> <span style="color:#a00;background-color:#faa">-tshut</span> <span style="color:#a00;background-color:#faa">-mode</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">tshut</span> <span style="color:#a00;background-color:#faa">mode</span> <span style="color:#a00;background-color:#faa">0:CRU</span> <span style="color:#a00;background-color:#faa">1:GPIO</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a00;background-color:#faa">rockchip</span> <span style="color:#a00;background-color:#faa">,hw</span> <span style="color:#a00;background-color:#faa">-tshut</span> <span style="color:#a00;background-color:#faa">-polarity</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">tshut</span> <span style="color:#a00;background-color:#faa">polarity</span> <span style="color:#a00;background-color:#faa">0:LOW</span> <span style="color:#a00;background-color:#faa">1:HIGH</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a00;background-color:#faa">status</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;okay&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#a00;background-color:#faa">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cpu--gpu配置">CPU &amp; GPU配置</h2>
<p>CPU在温控中作为cooling device，节点中需要包含#cooling-cells、dynamic-power-coefficient属性。
以RK3399为例：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-3-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-3-21">21</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">cpu_l</span><span style="color:#f60">0</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">cpu@</span><span style="color:#f60">0</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">device_type</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;cpu&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">compatible</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;arm,cortex-a53&#34;</span> , <span style="color:#309;font-weight:bold">&#34;arm,armv8&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">reg</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">enable</span> <span style="color:#a00;background-color:#faa">-method</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;psci&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">#cooling-cells</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">2</span><span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">标识，表⽰该设备可以作为⼀个cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clocks</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">ARMCLKL</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">cpu</span> <span style="color:#a00;background-color:#faa">-idle</span> <span style="color:#a00;background-color:#faa">-states</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">CPU_SLEEP</span> <span style="color:#a00;background-color:#faa">&amp;CLUSTER_SLEEP</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">dynamic</span> <span style="color:#a00;background-color:#faa">-power</span> <span style="color:#a00;background-color:#faa">-coefficient</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">100</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">动态功耗常数C，动态功耗公式为Pdyn=C*V^</span><span style="color:#f60">2</span><span style="color:#a00;background-color:#faa">*F</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>}<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">cpu_b</span><span style="color:#f60">0</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">cpu@</span><span style="color:#f60">100</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">device_type</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;cpu&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">compatible</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;arm,cortex-a72&#34;</span> , <span style="color:#309;font-weight:bold">&#34;arm,armv8&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">reg</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">100</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">enable</span> <span style="color:#a00;background-color:#faa">-method</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;psci&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">#cooling-cells</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">2</span><span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">标识，表⽰该设备可以作为⼀个cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clocks</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">ARMCLKB</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">cpu</span> <span style="color:#a00;background-color:#faa">-idle</span> <span style="color:#a00;background-color:#faa">-states</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">CPU_SLEEP</span> <span style="color:#a00;background-color:#faa">&amp;CLUSTER_SLEEP</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">dynamic</span> <span style="color:#a00;background-color:#faa">-power</span> <span style="color:#a00;background-color:#faa">-coefficient</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">436</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⽤于计算动态功耗的参数</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>}<span style="color:#a00;background-color:#faa">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>GPU在温控中作为cooling device，节点需要包含#cooling-cells属性和power_model⼦节点。
以RK3399为例：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-20">20</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">gpu</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">gpu@ff</span><span style="color:#f60">9</span><span style="color:#a00;background-color:#faa">a</span><span style="color:#f60">0000</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">compatible</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;arm,malit860&#34;</span> ,<span style="color:#309;font-weight:bold">&#34;arm,malit86x&#34;</span> ,<span style="color:#309;font-weight:bold">&#34;arm,malit8xx&#34;</span> , <span style="color:#309;font-weight:bold">&#34;arm,mali-midgard&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">reg</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">xff</span><span style="color:#f60">9</span><span style="color:#a00;background-color:#faa">a</span><span style="color:#f60">0000</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">0</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">x</span><span style="color:#f60">10000</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">interrupts</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;GIC_SPI</span> <span style="color:#f60">19</span> <span style="color:#a00;background-color:#faa">IRQ_TYPE_LEVEL_HIGH</span> <span style="color:#f60">0</span><span style="color:#a00;background-color:#faa">&gt;</span>, <span style="color:#a00;background-color:#faa">&lt;GIC_SPI</span> <span style="color:#a00;background-color:#faa">20</span> <span style="color:#a00;background-color:#faa">IRQ_TYPE_LEVEL_HIGH</span> <span style="color:#a00;background-color:#faa">0&gt;,</span> <span style="color:#a00;background-color:#faa">&lt;GIC_SPI</span> <span style="color:#a00;background-color:#faa">21</span> <span style="color:#a00;background-color:#faa">IRQ_TYPE_LEVEL_HIGH</span> <span style="color:#a00;background-color:#faa">0&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">interrupt</span> <span style="color:#a00;background-color:#faa">-names</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;GPU&#34;</span> , <span style="color:#309;font-weight:bold">&#34;JOB&#34;</span> , <span style="color:#309;font-weight:bold">&#34;MMU&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clocks</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cru</span> <span style="color:#a00;background-color:#faa">ACLK_GPU</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">clock</span> <span style="color:#a00;background-color:#faa">-names</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;clk_mali&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">#cooling-cells</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">2</span><span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">标识，表⽰该设备可以作为⼀个cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">power</span> <span style="color:#a00;background-color:#faa">-domains</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">power</span> <span style="color:#a00;background-color:#faa">RK</span><span style="color:#f60">3399</span><span style="color:#a00;background-color:#faa">_PD_GPU</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">power</span> <span style="color:#a00;background-color:#faa">-off</span> <span style="color:#a00;background-color:#faa">-delay</span> <span style="color:#a00;background-color:#faa">-ms</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">200</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">status</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;disabled&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">gpu_power_model</span> : <span style="color:#a00;background-color:#faa">power_model</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">compatible</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;arm,mali-simple-power-model&#34;</span> <span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">static</span> <span style="color:#a00;background-color:#faa">-coefficient</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">411000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⽤于计算静态功耗的参数</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">dynamic</span> <span style="color:#a00;background-color:#faa">-coefficient</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">733</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⽤于计算动态功耗的参数</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">ts</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;</span><span style="color:#f60">32000</span> <span style="color:#f60">4700</span> <span style="color:#a00;background-color:#faa">(</span> <span style="color:#f60">-80</span> <span style="color:#a00;background-color:#faa">)</span> <span style="color:#f60">2</span><span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⽤于计算静态功耗的参数</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">thermal</span> <span style="color:#a00;background-color:#faa">-zone</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#c30">&#34;gpu-thermal&#34;</span> <span style="color:#a00;background-color:#faa">;</span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">从gpu-thermal</span> <span style="color:#a00;background-color:#faa">获取温度，⽤于计算静态功耗</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#a00;background-color:#faa">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="termal-zone-配置">Termal zone 配置</h2>
<p>Termal zone节点主要⽤于配置温控策略相关的参数并⽣成对应的⽤⼾态接口。
以RK3399为例：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-22">22</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-23">23</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-24">24</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-25">25</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-26">26</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-27">27</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-28"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-28">28</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-29"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-29">29</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-30"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-30">30</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-31"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-31">31</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-32"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-32">32</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-33"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-33">33</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-34"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-34">34</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-35"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-35">35</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-36"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-36">36</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-37"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-37">37</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-38"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-38">38</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-39"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-39">39</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-40"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-40">40</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-41"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-41">41</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-42"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-42">42</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-43"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-43">43</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-44"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-44">44</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-45"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-45">45</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-46"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-46">46</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-47"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-47">47</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-48"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-48">48</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-49"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-49">49</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-50"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-50">50</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-51"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-51">51</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-52"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-52">52</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-53"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-53">53</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-54"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-54">54</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-55"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-55">55</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-56"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-56">56</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-57"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-57">57</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-58"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-58">58</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-59"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-59">59</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-60"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-60">60</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-61"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-61">61</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-62"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-62">62</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-63"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-63">63</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-64"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-64">64</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-65"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-65">65</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-66"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-66">66</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-67"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-67">67</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-68"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-68">68</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-69"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-69">69</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-70"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-70">70</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-71"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-71">71</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-72"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-72">72</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-73"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-73">73</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-74"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-74">74</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-75"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-75">75</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-76"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-76">76</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-77"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-77">77</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-78"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-78">78</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-79"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-79">79</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-80"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-80">80</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-81"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-81">81</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-82"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-82">82</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-83"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-83">83</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-84"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-84">84</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-85"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-85">85</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-86"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-86">86</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-87"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-87">87</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-88"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-88">88</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-89"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-89">89</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-5-90"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-5-90">90</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">thermal_zones</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">thermal</span> <span style="color:#a00;background-color:#faa">-zones</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⼀个节点对应⼀个thermal</span> <span style="color:#a00;background-color:#faa">zone</span> <span style="color:#a00;background-color:#faa">，并包含温控策略相关参数</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">soc_thermal</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">soc</span> <span style="color:#a00;background-color:#faa">-thermal</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度⾼于trip-point-0</span> <span style="color:#a00;background-color:#faa">指定的值，每隔20ms</span> <span style="color:#a00;background-color:#faa">获取⼀次温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">polling</span> <span style="color:#a00;background-color:#faa">-delay</span> <span style="color:#a00;background-color:#faa">-passive</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;20</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">milliseconds</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度低于trip-point-0</span> <span style="color:#a00;background-color:#faa">指定的值，每隔1000ms</span> <span style="color:#a00;background-color:#faa">获取⼀次温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">polling</span> <span style="color:#a00;background-color:#faa">-delay</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">milliseconds</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度等于trip-point-1</span> <span style="color:#a00;background-color:#faa">指定的值时，系统分配给cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">的能量</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">sustainable</span> <span style="color:#a00;background-color:#faa">-power</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">milliwatts</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">当前thermal</span> <span style="color:#a00;background-color:#faa">zone</span> <span style="color:#a00;background-color:#faa">通过tsadc0</span> <span style="color:#a00;background-color:#faa">获取温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">thermal</span> <span style="color:#a00;background-color:#faa">-sensors</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">tsadc</span> <span style="color:#a00;background-color:#faa">0&gt;;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">trips</span> <span style="color:#a00;background-color:#faa">包含不同温度阀值，不同的温控策略，配置不⼀定相同</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">trips</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">/*</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">温控阀值，超过该值温控策略开始⼯作，但不⼀定⻢上限制频率，</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">power</span> <span style="color:#a00;background-color:#faa">小到⼀定程度才开始限制频率</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">threshold</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">-point</span> <span style="color:#a00;background-color:#faa">-0</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">超过70</span> <span style="color:#a00;background-color:#faa">摄⽒度，温控策略开始⼯作，并且70</span> <span style="color:#a00;background-color:#faa">摄⽒度也是tsadc</span> <span style="color:#a00;background-color:#faa">触发中断的⼀个阀值</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">temperature</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;70000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度低于temperature-hysteresis</span> <span style="color:#a00;background-color:#faa">时触发中断，当前未实现，但是框架要求必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">hysteresis</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;2000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">type</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;passive&#34;</span> <span style="color:#a00;background-color:#faa">;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">表⽰超过该温度值时，使⽤polling-delay-passive</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温控⽬标温度，期望通过降频使得芯⽚不超过该值</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">target</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">-point</span> <span style="color:#f60">-1</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">期望通过降频使得芯⽚不超过85</span> <span style="color:#a00;background-color:#faa">摄⽒度，并且85</span> <span style="color:#a00;background-color:#faa">摄⽒度也是tsadc</span> <span style="color:#a00;background-color:#faa">触发中断的⼀个阀值</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">temperature</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;85000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度低于temperature-hysteresis</span> <span style="color:#a00;background-color:#faa">时触发中断，当前未实现，但是框架要求必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">hysteresis</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;2000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">type</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;passive&#34;</span> <span style="color:#a00;background-color:#faa">;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">表⽰超过该温度值时，使⽤polling-delay-passive</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">过温保护阀值，如果降频后温度仍然上升，那么超过该值后，让系统重启</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">soc_crit</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">soc</span> <span style="color:#a00;background-color:#faa">-crit</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">超过115</span> <span style="color:#a00;background-color:#faa">摄⽒度重启，并且115</span> <span style="color:#a00;background-color:#faa">摄⽒度也是tsadc</span> <span style="color:#a00;background-color:#faa">触发中断的⼀个阀值</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">temperature</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;115000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">温度低于temperature-hysteresis</span> <span style="color:#a00;background-color:#faa">时触发中断，当前未实现，但是框架要求必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">hysteresis</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;2000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">millicelsius</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">type</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#309;font-weight:bold">&#34;critical&#34;</span> <span style="color:#a00;background-color:#faa">;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">表⽰超过该温度值时，重启</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>            }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">配置节点，每个⼦节点代表⼀个cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">-maps</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">map0</span> <span style="color:#a00;background-color:#faa">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">表⽰在target</span> <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">下，该cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">才起作⽤，</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">对于power</span> <span style="color:#a00;background-color:#faa">allocater</span> <span style="color:#a00;background-color:#faa">策略必须填target</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">target</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">A53</span> <span style="color:#a00;background-color:#faa">做为cooloing</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">，</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">不起作⽤，但必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">-device</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cpu_l0</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">contribution</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;4096</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">计算功耗时乘以4096/1024</span> <span style="color:#a00;background-color:#faa">倍，⽤于调整降频顺序和尺度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">map</span><span style="color:#f60">1</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">表⽰在target</span> <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">下，该cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">才起作⽤，</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">对于power</span> <span style="color:#a00;background-color:#faa">allocater</span> <span style="color:#a00;background-color:#faa">策略必须填target</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">target</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">A72</span> <span style="color:#a00;background-color:#faa">做为cooloing</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">，</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">不起作⽤，但必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">-device</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">cpu_b0</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">contribution</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1024</span> <span style="color:#a00;background-color:#faa">&gt;;/*</span> <span style="color:#a00;background-color:#faa">计算功耗时乘以1024/1024</span> <span style="color:#a00;background-color:#faa">倍，⽤于调整降频顺序和尺度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a00;background-color:#faa">map</span><span style="color:#f60">2</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">表⽰在target</span> <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">下，该cooling</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">才起作⽤，</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*</span> <span style="color:#a00;background-color:#faa">对于power</span> <span style="color:#a00;background-color:#faa">allocater</span> <span style="color:#a00;background-color:#faa">策略必须填target</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">trip</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">target</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">GPU</span> <span style="color:#a00;background-color:#faa">做为cooloing</span> <span style="color:#a00;background-color:#faa">device</span> <span style="color:#a00;background-color:#faa">，</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">不起作⽤，但必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">cooling</span> <span style="color:#a00;background-color:#faa">-device</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">gpu</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">THERMAL_NO_LIMIT</span> <span style="color:#a00;background-color:#faa">&gt;;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a00;background-color:#faa">contribution</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;4096</span> <span style="color:#a00;background-color:#faa">&gt;;/*</span> <span style="color:#a00;background-color:#faa">计算功耗时乘以4096/1024</span> <span style="color:#a00;background-color:#faa">倍，⽤于调整降频顺序和尺度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>                }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">};</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">⼀个节点对应⼀个thermal</span> <span style="color:#a00;background-color:#faa">zone</span> <span style="color:#a00;background-color:#faa">，并包含温控策略相关参数，当前thermal</span> <span style="color:#a00;background-color:#faa">zone</span> <span style="color:#a00;background-color:#faa">只⽤于获取温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a00;background-color:#faa">gpu_thermal</span> <span style="color:#a00;background-color:#faa">:</span> <span style="color:#a00;background-color:#faa">gpu</span> <span style="color:#a00;background-color:#faa">-thermal</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">包含温控策略配置的情况下才起作⽤，架要求必须填</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">polling</span> <span style="color:#a00;background-color:#faa">-delay</span> <span style="color:#a00;background-color:#faa">-passive</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;100</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">milliseconds</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">每隔1000ms</span> <span style="color:#a00;background-color:#faa">获取⼀次温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">polling</span> <span style="color:#a00;background-color:#faa">-delay</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;1000</span> <span style="color:#a00;background-color:#faa">&gt;;</span> <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">milliseconds</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">/*</span> <span style="color:#a00;background-color:#faa">当前thermal</span> <span style="color:#a00;background-color:#faa">zone</span> <span style="color:#a00;background-color:#faa">通过tsadc1</span> <span style="color:#a00;background-color:#faa">获取温度</span> <span style="color:#a00;background-color:#faa">*/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a00;background-color:#faa">thermal</span> <span style="color:#a00;background-color:#faa">-sensors</span> <span style="color:#a00;background-color:#faa">=</span> <span style="color:#a00;background-color:#faa">&lt;&amp;</span> <span style="color:#a00;background-color:#faa">tsadc</span> <span style="color:#a00;background-color:#faa">1&gt;;</span>
</span></span><span style="display:flex;"><span>    }<span style="color:#a00;background-color:#faa">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a00;background-color:#faa">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="态接口">⽤⼾态接口</h1>
<p>⽤⼾态接口在/sys/class/thermal/⽬录下，具体内容和DTSI中thermal zone节点的配置对应。有的平台thermalzone节点下只有⼀个⼦节点，对应/sys/class/thermal/⽬录下也只有thermal_zone0⼦⽬录；有的平台有两个⼦节点，对应/sys/class/thermal/⽬录下就会有thermal_zone0和thermal_zone1⼦⽬录。通过⽤⼾态接口可以切换温控策略，查看当前温度等。
以RK3399为例⼦，/sys/class/thermal/thermal_zone0/⽬录下包含如下常⽤的信息：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-1"> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-2"> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-3"> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-4"> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-5"> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-6"> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-7"> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-8"> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-9"> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-10">10</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-11">11</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-12">12</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-13">13</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-14">14</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-15">15</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-16">16</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-17">17</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-18">18</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-19">19</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-20">20</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-21">21</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-22"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-22">22</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-23"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-23">23</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-24"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-24">24</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-25"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-25">25</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-26"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-26">26</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-6-27"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-6-27">27</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-verilog" data-lang="verilog"><span style="display:flex;"><span>temp <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#a00;background-color:#faa"> </span> <span style="color:#09f;font-style:italic">/* 当前温度 */</span>
</span></span><span style="display:flex;"><span>available_policies <span style="color:#09f;font-style:italic">/* ⽀持的温控策略 */</span>
</span></span><span style="display:flex;"><span>policy <span style="color:#09f;font-style:italic">/* 当前使⽤的温控策略 */</span>
</span></span><span style="display:flex;"><span>sustainable_power <span style="color:#09f;font-style:italic">/* 期望的最⾼温度下对应的power 值 */</span>
</span></span><span style="display:flex;"><span>integral_cutoff <span style="color:#09f;font-style:italic">/* PID 算法中I的触发条件：当前温度-期望的最⾼温度&lt;integral_cutoff */</span>
</span></span><span style="display:flex;"><span>k_d <span style="color:#09f;font-style:italic">/* PID 算法中计算D的时候⽤的参数 */</span>
</span></span><span style="display:flex;"><span>k_i <span style="color:#09f;font-style:italic">/* PID 算法中计算I的时候⽤的参数 */</span>
</span></span><span style="display:flex;"><span>k_po <span style="color:#09f;font-style:italic">/* PID 算法中计算P的时候⽤的参数 */</span>
</span></span><span style="display:flex;"><span>k_pu <span style="color:#09f;font-style:italic">/* PID 算法中计算P的时候⽤的参数 */</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#09f;font-style:italic">/* enabled ：⾃带定时获取温度，判断是否需要降频。disabled 关闭该功能 */</span>
</span></span><span style="display:flex;"><span><span style="color:#069;font-weight:bold">type</span> <span style="color:#09f;font-style:italic">/* 当前thermal zone 的类型 */</span>
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/* 不同的温度阀值，对应trips 节点的配置 */</span>
</span></span><span style="display:flex;"><span>trip_point_0_hyst
</span></span><span style="display:flex;"><span>trip_point_0_temp
</span></span><span style="display:flex;"><span>trip_point_0_type
</span></span><span style="display:flex;"><span>trip_point_1_hyst
</span></span><span style="display:flex;"><span>trip_point_1_temp
</span></span><span style="display:flex;"><span>trip_point_1_type
</span></span><span style="display:flex;"><span>trip_point_2_hyst
</span></span><span style="display:flex;"><span>trip_point_2_temp
</span></span><span style="display:flex;"><span>trip_point_2_type
</span></span><span style="display:flex;"><span><span style="color:#09f;font-style:italic">/* 不同cooling devic 的状态，对应cooling-maps 节点的配置 */</span>
</span></span><span style="display:flex;"><span>cdev0 <span style="color:#09f;font-style:italic">/* 代表⼀个cooling devic ，有的平台还有cdev1 、cdev2 等 */</span>
</span></span><span style="display:flex;"><span> cur_state <span style="color:#09f;font-style:italic">/* 该cooling device 当前频率的档位 */</span>
</span></span><span style="display:flex;"><span> max_state <span style="color:#09f;font-style:italic">/* 该cooling device 最多有⼏个档位 */</span>
</span></span><span style="display:flex;"><span> <span style="color:#069;font-weight:bold">type</span> <span style="color:#09f;font-style:italic">/* 该cooling device 的类型 */</span>
</span></span><span style="display:flex;"><span>cdev0_weight <span style="color:#09f;font-style:italic">/* 该cooling devic 在计算power 时扩⼤的倍数 */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="常用设置">常用设置</h1>
<h2 id="获取当前温度">获取当前温度</h2>
<p>直接查看⽤⼾态接口thermal_zone0或者thermal_zone1⽬录下的temp节点即可。
以RK3399为例，获取CPU温度，在串口中输⼊如下命令：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-7-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-7-1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /sys /class /thermal /thermal_zone0 /temp
</span></span></code></pre></td></tr></table>
</div>
</div><p>获取GPU温度，在串口中输⼊如下命令：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-8-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-8-1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /sys /class /thermal /thermal_zone1 /temp
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="关闭温度控制功能">关闭温度控制功能</h2>
<p>⽅法⼀：menuconfig中默认温控策略设置为user_space。</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-1">1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-2">2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-3">3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-4">4</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-9-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-9-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>&lt;*&gt; Generic Thermal sysfs driver   ---&gt;
</span></span><span style="display:flex;"><span> --- Generic Thermal sysfs driver
</span></span><span style="display:flex;"><span> [*]   APIs to parse thermal data out of device tree
</span></span><span style="display:flex;"><span> [*]   Enable writable trip points
</span></span><span style="display:flex;"><span> Default Thermal governor ( user_space )   ---&gt;   /* power_allocator 改为user_space */
</span></span></code></pre></td></tr></table>
</div>
</div><p>⽅法⼆：开机后通过命令关温控。
⾸先，把温控策略切换到user_space，即把⽤⼾态接口下的policy节点改成user_space；或者把mode设置成
disabled状态；然后，解除频率限制，即将⽤⼾态接口下的所有cdev的cur_state设置为0。
以RK3399为例，策略切换到user_space：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-10-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-10-1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>echo user_space &gt; /sys /class /thermal /thermal_zone0 /policy
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者把mode设置成disabled状态：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-11-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-11-1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>echo disabled &gt; /sys /class /thermal /thermal_zone0 /mode
</span></span></code></pre></td></tr></table>
</div>
</div><p>解除频率限制：</p>
<div class="highlight"><div style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-1">1</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-2">2</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-3">3</a>
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-12-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-12-4">4</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>/* 具体有多少个cdev ，根据实际情况修改 */
</span></span><span style="display:flex;"><span>echo 0 &gt; /sys /class /thermal /thermal_zone0 /cdev0 /cur_state
</span></span><span style="display:flex;"><span>echo 0 &gt; /sys /class /thermal /thermal_zone0 /cdev1 /cur_state
</span></span><span style="display:flex;"><span>echo 0 &gt; /sys /class /thermal /thermal_zone0 /cdev2 /cur_state
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="参考">参考</h1>
<p><a href="https://usermanual.wiki/Document/RockchipDeveloperGuideLinux44ThermalCN.554781299/html" target="_blank" rel="noopener noreffer ">Thermal开发指南</a></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-02-09</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" data-title="Embedded:RK3399 Thermal (温度控制)" data-hashtags="Embedded,芯片&开发板,RK3399"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" data-hashtag="Embedded"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" data-title="Embedded:RK3399 Thermal (温度控制)"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" data-title="Embedded:RK3399 Thermal (温度控制)"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://zhangyuhu.github.io/posts/embedded/developmentboard/rk3399/thermal/thermal/" data-title="Embedded:RK3399 Thermal (温度控制)" data-ralateuid="ji"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/embedded/">Embedded</a>,&nbsp;<a href="/tags/%E8%8A%AF%E7%89%87%E5%BC%80%E5%8F%91%E6%9D%BF/">芯片&amp;开发板</a>,&nbsp;<a href="/tags/rk3399/">RK3399</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/embedded/developmentboard/rv1126rv1109/rv1126_camera%E8%B0%83%E8%AF%95%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="prev" rel="prev" title="Embedded:RV1126 camera调试常用命令"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Embedded:RV1126 camera调试常用命令</a>
            <a href="/posts/embedded/developmentboard/rk3399/rknn/" class="next" rel="next" title="Embedded:RK3399 RKNN">Embedded:RK3399 RKNN<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="giscus" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app">Giscus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">为天地立心,为生民立命,为往圣继绝学,为万世开太平</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://zhangyuhu.github.io/" target="_blank">zhangyuhu</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="http://creativecommons.org/licenses/by/4.0/" target="_blank">知识共享署名 4.0 国际许可协议</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":100},"comment":{"giscus":{"category":"Comments","categoryId":"DIC_kwDOIx2Cjs4CTnUX","darkTheme":"dark","emitMetadata":"0","inputPosition":"bottom","lang":"en","lazyLoading":false,"lightTheme":"light","mapping":"pathname","reactionsEnabled":"1","repo":"zhangyuhu/zhangyuhu.github.io","repoId":"R_kgDOIx2Cjg"}},"data":{"id-1":"HOME","id-2":"HOME"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"twemoji":true,"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.2970a33d719df7cd89cebf586152b32a8ed30012227fa81b44282950146e0f595d1c733779e4d423dda1004bdcf707ee64d0fadc3d21229cd66b960788f84bdb.js" integrity="sha512-KXCjPXGd982Jzr9YYVKzKo7TABIif6gbRCgpUBRuD1ldHHM3eeTUI92hAEvc9wfuZND63D0hIpzWa5YHiPhL2w=="></script></body>
</html>
